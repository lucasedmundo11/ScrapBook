# ScrapBook API

Uma API RESTful completa para web scraping de livros com foco em Machine Learning Engineering. Este projeto extrai dados de livros do site [books.toscrape.com](http://books.toscrape.com/) e disponibiliza atrav√©s de uma API robusta constru√≠da com Flask e SQLAlchemy.

## üìã √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Arquitetura](#arquitetura)
- [Funcionalidades](#funcionalidades)
- [Instala√ß√£o](#instala√ß√£o)
- [Configura√ß√£o](#configura√ß√£o)
- [Execu√ß√£o](#execu√ß√£o)
- [Documenta√ß√£o da API](#documenta√ß√£o-da-api)
- [Endpoints](#endpoints)
- [Exemplos de Uso](#exemplos-de-uso)
- [Autentica√ß√£o](#autentica√ß√£o)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [Contribui√ß√£o](#contribui√ß√£o)

## üöÄ Vis√£o Geral

O ScrapBook API √© um sistema completo de web scraping e an√°lise de dados de livros, projetado com as melhores pr√°ticas de Machine Learning Engineering. O projeto inclui:

- **Web Scraping Robusto**: Sistema de extra√ß√£o de dados com retry logic e rate limiting
- **API RESTful Completa**: 20+ endpoints para gerenciamento de dados
- **Autentica√ß√£o JWT**: Sistema seguro de autentica√ß√£o e autoriza√ß√£o
- **Documenta√ß√£o Swagger**: Interface interativa para explorar a API
- **Gerenciamento de Usu√°rios**: Sistema completo de CRUD para usu√°rios
- **Pipeline de ML**: Endpoints espec√≠ficos para features de Machine Learning
- **Monitoramento**: Sistema de logs estruturados e m√©tricas

## üèóÔ∏è Arquitetura

```
ScrapBook/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/              # API Flask com endpoints RESTful
‚îÇ   ‚îú‚îÄ‚îÄ scripts/          # Sistema de web scraping
‚îÇ   ‚îú‚îÄ‚îÄ config/           # Configura√ß√µes centralizadas
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ csv/              # Dados extra√≠dos em CSV
‚îÇ   ‚îú‚îÄ‚îÄ json/             # Dados em formato JSON
‚îÇ   ‚îî‚îÄ‚îÄ logs/             # Logs do sistema
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ resources/        # Documenta√ß√£o de Funcionalidades e Requisitos Funcionais
‚îÇ   ‚îî‚îÄ‚îÄ swagger/          # Documenta√ß√£o Swagger YAML
‚îî‚îÄ‚îÄ tests/                # Testes automatizados
```

### Componentes Principais

1. **Web Scraper**: Sistema baseado em BeautifulSoup para extra√ß√£o de dados
2. **API REST**: Flask + SQLAlchemy para endpoints RESTful
3. **Banco de Dados**: SQLAlchemy com suporte a SQLite/PostgreSQL
4. **Autentica√ß√£o**: JWT com Flask-JWT-Extended
5. **Documenta√ß√£o**: Swagger/OpenAPI com Flasgger

## ‚ú® Funcionalidades

### Core Features
- ‚úÖ Listagem paginada de livros
- ‚úÖ Busca avan√ßada por t√≠tulo, categoria, pre√ßo e rating
- ‚úÖ Estat√≠sticas e insights dos dados
- ‚úÖ Filtros por faixa de pre√ßo
- ‚úÖ Top livros mais bem avaliados

### Sistema de Usu√°rios
- ‚úÖ Registro e login de usu√°rios
- ‚úÖ Gerenciamento completo de usu√°rios (CRUD)
- ‚úÖ Controle de acesso baseado em roles (admin/user)
- ‚úÖ Altera√ß√£o de senha segura

### Web Scraping
- ‚úÖ Execu√ß√£o manual de scraping via API
- ‚úÖ Monitoramento de jobs de scraping
- ‚úÖ Hist√≥rico de execu√ß√µes
- ‚úÖ Rate limiting e retry logic

### Machine Learning
- ‚úÖ Endpoints para features engineering
- ‚úÖ Datasets formatados para treinamento
- ‚úÖ Interface para predi√ß√µes de modelos

## üîß Instala√ß√£o

### Pr√©-requisitos

- Python 3.11+
- pip
- virtualenv (recomendado)

### Passo a Passo

1. **Clone o reposit√≥rio**
```bash
git clone <repository-url>
cd ScrapBook
```

2. **Crie e ative o ambiente virtual**
```bash
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# ou
.venv\Scripts\activate     # Windows
```

3. **Instale as depend√™ncias**
```bash
pip install -r requirements.txt
```

4. **Configure as vari√°veis de ambiente**
```bash
cp .env.example .env  # Se dispon√≠vel
# ou crie um arquivo .env com as configura√ß√µes necess√°rias
```

## ‚öôÔ∏è Configura√ß√£o

### Vari√°veis de Ambiente

Crie um arquivo `.env` na raiz do projeto com as seguintes vari√°veis:

```env
# API Settings
API_HOST=localhost
API_PORT=8000

# JWT Configuration
JWT_SECRET_KEY=your-super-secret-jwt-key-change-in-production
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# Database
DATABASE_URL=sqlite:///./data/books.db

# Rate Limiting
RATE_LIMIT_REQUESTS_PER_MINUTE=60

# CORS
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
```

### Configura√ß√£o do Banco de Dados

O sistema criar√° automaticamente:
- Banco de dados SQLite em `data/books.db`
- Usu√°rio admin padr√£o: `admin`/`admin123`
- Usu√°rio comum padr√£o: `user`/`user123`

## üöÄ Execu√ß√£o

### Iniciar a API

```bash
# M√©todo 1: Via m√≥dulo
python -m src.api.main

# M√©todo 2: Executar diretamente
cd src/api && python main.py

# M√©todo 3: Com script personalizado (se dispon√≠vel)
./start_api.sh
```

A API estar√° dispon√≠vel em: `http://localhost:8000`

### Acessar Documenta√ß√£o

- **Swagger UI**: http://localhost:8000/docs
- **API Spec**: http://localhost:8000/apispec.json
- **Health Check**: http://localhost:8000/api/v1/health

## üìö Documenta√ß√£o da API

### Base URL
```
http://localhost:8000/api/v1
```

### Autentica√ß√£o
A API usa JWT Bearer tokens. Para endpoints protegidos, inclua o header:
```
Authorization: Bearer <seu-jwt-token>
```

### Response Format
Todas as respostas seguem o padr√£o:

```json
{
  "success": true,
  "data": { ... },
  "message": "Success message",
  "timestamp": "2025-08-10T10:30:00Z"
}
```

Para erros:
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Error description",
    "details": { ... }
  },
  "timestamp": "2025-08-10T10:30:00Z"
}
```

## üõ£Ô∏è Endpoints

### üîç Core Endpoints

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| `GET` | `/health` | Status da API | ‚ùå |
| `GET` | `/books` | Lista todos os livros | ‚ùå |
| `GET` | `/books/{id}` | Detalhes de um livro | ‚ùå |
| `GET` | `/books/search` | Busca livros | ‚ùå |
| `GET` | `/categories` | Lista categorias | ‚ùå |

### üìä Endpoints de Insights

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| `GET` | `/stats/overview` | Estat√≠sticas gerais | ‚ùå |
| `GET` | `/stats/categories` | Stats por categoria | ‚ùå |
| `GET` | `/books/top-rated` | Top livros avaliados | ‚ùå |
| `GET` | `/books/price-range` | Filtro por pre√ßo | ‚ùå |

### üîê Autentica√ß√£o

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| `POST` | `/auth/login` | Login do usu√°rio | ‚ùå |
| `POST` | `/auth/refresh` | Renovar token | ‚ùå |

### üë• Gerenciamento de Usu√°rios

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| `GET` | `/users` | Listar usu√°rios | ‚úÖ Admin |
| `POST` | `/users` | Criar usu√°rio | ‚úÖ Admin |
| `PUT` | `/users/{id}` | Atualizar usu√°rio | ‚úÖ Admin/Own |
| `PUT` | `/users/{id}/password` | Alterar senha | ‚úÖ Admin/Own |
| `GET` | `/users/me` | Perfil atual | ‚úÖ |

### ü§ñ Machine Learning

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| `GET` | `/ml/features` | Features para ML | ‚ùå |
| `GET` | `/ml/training-data` | Dataset treinamento | ‚ùå |
| `POST` | `/ml/predictions` | Fazer predi√ß√µes | ‚ùå |

### üï∑Ô∏è Web Scraping

| M√©todo | Endpoint | Descri√ß√£o | Auth |
|--------|----------|-----------|------|
| `POST` | `/scraping/trigger` | Iniciar scraping | ‚úÖ Admin |
| `GET` | `/scraping/status/{job_id}` | Status do job | ‚úÖ Admin |
| `GET` | `/scraping/jobs` | Listar jobs | ‚úÖ Admin |

## üìñ Exemplos de Uso

### 1. Login e Obten√ß√£o de Token

```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**Response:**
```json
{
  "success": true,
  "data": {
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "token_type": "bearer",
    "expires_in": 1800
  },
  "message": "Login successful",
  "timestamp": "2025-08-10T15:30:00Z"
}
```

### 2. Listar Livros com Pagina√ß√£o

```bash
curl -X GET "http://localhost:8000/api/v1/books?page=1&limit=5&sort_by=price&sort_order=desc"
```

**Response:**
```json
{
  "success": true,
  "data": {
    "books": [
      {
        "id": 1,
        "title": "A Light in the Attic",
        "price": 51.77,
        "rating": 3,
        "availability": "In stock",
        "category": "Poetry",
        "image_url": "catalogue/images/products/51/51.jpg"
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 200,
      "total_books": 1000,
      "has_next": true,
      "has_prev": false
    }
  },
  "message": "Retrieved 5 books",
  "timestamp": "2025-08-10T15:30:00Z"
}
```

### 3. Buscar Livros

```bash
curl -X GET "http://localhost:8000/api/v1/books/search?title=Light&category=Poetry&min_price=30&max_price=60"
```

### 4. Criar Usu√°rio (Admin)

```bash
curl -X POST http://localhost:8000/api/v1/users \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <seu-token>" \
  -d '{
    "username": "newuser",
    "email": "user@example.com",
    "password": "password123",
    "is_admin": false
  }'
```

### 5. Executar Scraping

```bash
curl -X POST http://localhost:8000/api/v1/scraping/trigger \
  -H "Authorization: Bearer <seu-token>"
```

**Response:**
```json
{
  "success": true,
  "data": {
    "job_id": "scraping_job_20250810_153045",
    "status": "started",
    "message": "Scraping job started successfully"
  },
  "message": "Scraping process started",
  "timestamp": "2025-08-10T15:30:45Z"
}
```

### 6. Verificar Status do Scraping

```bash
curl -X GET http://localhost:8000/api/v1/scraping/status/scraping_job_20250810_153045 \
  -H "Authorization: Bearer <seu-token>"
```

### 7. Obter Estat√≠sticas

```bash
curl -X GET http://localhost:8000/api/v1/stats/overview
```

**Response:**
```json
{
  "success": true,
  "data": {
    "total_books": 1000,
    "total_categories": 50,
    "average_price": 35.67,
    "average_rating": 3.2,
    "most_expensive_book": {
      "title": "Expensive Book",
      "price": 58.99
    },
    "cheapest_book": {
      "title": "Cheap Book", 
      "price": 10.00
    }
  },
  "message": "Overview statistics retrieved successfully",
  "timestamp": "2025-08-10T15:30:00Z"
}
```

## üîê Autentica√ß√£o

### Usu√°rios Padr√£o

O sistema vem com usu√°rios pr√©-configurados:

| Username | Password | Role | Descri√ß√£o |
|----------|----------|------|-----------|
| `admin` | `admin123` | Admin | Acesso completo ao sistema |
| `user` | `user123` | User | Acesso limitado aos endpoints p√∫blicos |

### Cria√ß√£o de Novos Usu√°rios

Apenas administradores podem criar novos usu√°rios atrav√©s do endpoint `/users`.

### Expira√ß√£o de Tokens

- **Access Token**: 30 minutos (configur√°vel)
- **Refresh Token**: 7 dias (configur√°vel)

## üóÇÔ∏è Estrutura do Projeto

```
ScrapBook/
‚îú‚îÄ‚îÄ .venv/                          # Ambiente virtual Python
‚îú‚îÄ‚îÄ data/                           # Dados extra√≠dos e logs
‚îÇ   ‚îú‚îÄ‚îÄ csv/                        # Arquivos CSV dos livros
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ books_detailed_*.csv    # Dados detalhados dos livros
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ categories_*.csv        # Lista de categorias
‚îÇ   ‚îú‚îÄ‚îÄ json/                       # Dados em formato JSON
‚îÇ   ‚îî‚îÄ‚îÄ logs/                       # Logs do sistema
‚îú‚îÄ‚îÄ docs/                           # Documenta√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ swagger/                    # Specs Swagger YAML
‚îÇ       ‚îú‚îÄ‚îÄ auth_*.yaml            # Endpoints de autentica√ß√£o
‚îÇ       ‚îú‚îÄ‚îÄ books_*.yaml           # Endpoints de livros
‚îÇ       ‚îú‚îÄ‚îÄ users_*.yaml           # Endpoints de usu√°rios
‚îÇ       ‚îî‚îÄ‚îÄ *.yaml                 # Outros endpoints
‚îú‚îÄ‚îÄ src/                            # C√≥digo fonte principal
‚îÇ   ‚îú‚îÄ‚îÄ api/                        # API Flask
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py                # Aplica√ß√£o principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py                # Sistema de autentica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py            # Gerenciador do banco
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py              # Modelos SQLAlchemy/Pydantic
‚îÇ   ‚îú‚îÄ‚îÄ config/                     # Configura√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.py                 # Config da API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Scrapper.py            # Config do scraper
‚îÇ   ‚îî‚îÄ‚îÄ scripts/                    # Sistema de scraping
‚îÇ       ‚îú‚îÄ‚îÄ main_scraper.py        # Orquestrador principal
‚îÇ       ‚îú‚îÄ‚îÄ book_scraper.py        # Scraper de livros
‚îÇ       ‚îú‚îÄ‚îÄ category_scraper.py    # Scraper de categorias
‚îÇ       ‚îî‚îÄ‚îÄ utils/                 # Utilit√°rios
‚îú‚îÄ‚îÄ tests/                          # Testes automatizados
‚îú‚îÄ‚îÄ requirements.txt                # Depend√™ncias Python
‚îú‚îÄ‚îÄ .env.example                    # Exemplo de vari√°veis de ambiente
‚îî‚îÄ‚îÄ README.md                       # Este arquivo
```

## üß™ Testes

### Executar Testes

```bash
# Todos os testes
pytest

# Testes espec√≠ficos
pytest tests/test_api.py
pytest tests/test_scraper.py

# Com cobertura
pytest --cov=src tests/
```

### Health Check

Verifique se a API est√° funcionando:

```bash
curl http://localhost:8000/api/v1/health
```

## üîÑ Pipeline de Dados

### Fluxo do Scraping

1. **Trigger Manual**: Via endpoint `/scraping/trigger`
2. **Extra√ß√£o**: Scraping do site books.toscrape.com
3. **Processamento**: Limpeza e valida√ß√£o dos dados
4. **Armazenamento**: Salvamento em CSV e banco de dados
5. **Notifica√ß√£o**: Job status dispon√≠vel via API

### Estrutura dos Dados

Os dados extra√≠dos incluem:
- **Title**: T√≠tulo do livro
- **Price**: Pre√ßo em GBP
- **Rating**: Avalia√ß√£o (1-5 estrelas)
- **Availability**: Status de disponibilidade
- **Category**: Categoria/g√™nero
- **Image URL**: URL da imagem da capa
- **Description**: Descri√ß√£o do livro

## üìä Monitoramento e Logs

### Sistema de Logs

- **Structured Logging**: Logs em formato JSON
- **Diferentes N√≠veis**: INFO, WARNING, ERROR
- **Rota√ß√£o Autom√°tica**: Para evitar arquivos grandes
- **Localiza√ß√£o**: `data/logs/`

### M√©tricas Dispon√≠veis

- Tempo de resposta dos endpoints
- N√∫mero de requisi√ß√µes por minuto
- Erros e exce√ß√µes
- Status dos jobs de scraping

## üöÄ Deploy

### Desenvolvimento Local

```bash
python -m src.api.main
```

### Produ√ß√£o

O sistema est√° preparado para deploy em:
- **Heroku**
- **Render**
- **AWS**
- **Docker**

### Vari√°veis de Ambiente para Produ√ß√£o

```env
API_HOST=0.0.0.0
API_PORT=5000
JWT_SECRET_KEY=<strong-secret-key>
DATABASE_URL=postgresql://user:pass@host:port/db
CORS_ORIGINS=https://yourdomain.com
```

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para mais detalhes.

## üìû Suporte

- **Documenta√ß√£o**: http://localhost:8000/docs
- **Issues**: GitHub Issues
- **Email**: support@scrapbook-api.com

---

**Desenvolvido com ‚ù§Ô∏è para Machine Learning Engineering**
